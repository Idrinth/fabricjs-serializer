function i(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function e(r,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,i.key,i)}}function r(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}var idrinth=idrinth||{};idrinth.FabricJsSerializer=function(){function b(r,t){return"string"==typeof t&&{}.hasOwnProperty.call(r,t)}var o=["left","top","type"],a=function(){"use strict";function n(r,t){if(i(this,n),"function"!=typeof r)throw new Error("The factory has to be a function.");if(!Array.isArray(t))throw new Error("The dependencies have to be an array.");this.r=r,this.t=t}return r(n,[{key:"isDependant",value:function(r){return this.t.includes(r)}},{key:"isSaveworthy",value:function(r,t){function n(r){return Array.isArray(r)&&!r.length}var i,e;return!(!o.includes(r)&&b(this.r,r)&&((i=t)===(e=this.r[r])||n(i)&&n(e)))}}]),n}();return function(){"use strict";function t(r){i(this,t),this.n=r,this.i=function(){for(var r,t={radial:new a(fabric.Gradient,[])},n=0,i=Object.keys(fabric);n<i.length;n++){var e=i[n];(r=e).match(/^[A-Z]/)&&"function"==typeof fabric[r]&&b(fabric[r].prototype,"type")&&"string"==typeof fabric[r].prototype.type&&(t[fabric[e].prototype.type]=new a(fabric[e],[]))}return t}()}return r(t,[{key:"register",value:function(r,t){for(var n=arguments.length,i=new Array(2<n?n-2:0),e=2;e<n;e++)i[e-2]=arguments[e];this.i[r]=new a(t,i||[])}},{key:"fromJson",value:function(r){var t=JSON.parse(r),n=this.n.renderOnAddRemove,i=!(this.n.renderOnAddRemove=!1),e=!1,o=void 0;try{for(var a,f=this.n._objects[Symbol.iterator]();!(i=(a=f.next()).done);i=!0){var c=a.value;this.n.remove(c)}}catch(r){e=!0,o=r}finally{try{i||null==f.return||f.return()}finally{if(e)throw o}}var u=this.i;t.objects.sort(function(r,t){if(!b(u,r.type))throw new Error("Can't find a definition for given type ".concat(r.type));if(!b(u,t.type))throw new Error("Can't find a definition for given type ".concat(t.type));return u[r.type].isDependant(t.type)?1:u[t.type].isDependant(r.type)?-1:0});var s=!0,h=!1,v=void 0;try{for(var y,l=t.objects[Symbol.iterator]();!(s=(y=l.next()).done);s=!0){var w=y.value;this.n.add(this.i[w.type].factory(w))}}catch(r){h=!0,v=r}finally{try{s||null==l.return||l.return()}finally{if(h)throw v}}this.n.renderOnAddRemove=n,this.n.renderAll()}},{key:"toJson",value:function(){var a=this.i;return JSON.stringify({version:fabric.version,objects:this.n._objects.map(function(r){var t=r.toObject();if(!t.type||!b(a,t.type))throw new Error("Can't find a definition for given type ".concat(t.type));for(var n={},i=0,e=Object.keys(t);i<e.length;i++){var o=e[i];a[t.type].isSaveworthy(o,t[o])&&(n[o]=t[o])}return n})})}}]),t}()}();