function e(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}function i(n,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}function n(n,r,t){return r&&i(n.prototype,r),t&&i(n,t),n}var idrinth=idrinth||{};idrinth.FabricJsSerializer=function(){function k(n,r){return"string"==typeof r&&{}.hasOwnProperty.call(n,r)}var o=["left","top","type"],f=function(){"use strict";function t(n,r){if(e(this,t),"function"!=typeof n)throw new Error("The factory has to be a function.");if(!Array.isArray(r))throw new Error("The dependencies have to be an array.");this.n=n,this.r=r}return n(t,[{key:"isDependant",value:function(n){return this.r.includes(n)}},{key:"isSaveworthy",value:function(n,r){function t(n){return Array.isArray(n)&&!n.length}var e,i;return!(!o.includes(n)&&k(this.n,n)&&((e=r)===(i=this.n[n])||t(e)&&t(i)))}}]),t}();return function(){"use strict";function r(n){e(this,r),this.t=n,this.e={circle:new f(function(n){return new fabric.Circle(n)},[]),ellipse:new f(function(n){return new fabric.Ellipse(n)},[]),group:new f(function(n){return new fabric.Group(n.objects,n)},[]),"i-text":new f(function(n){return new fabric.IText(n.text,n)},[]),image:new f(function(n){return new fabric.Image.fromURL(n.src,n)},[]),line:new f(function(n){return new fabric.Line(n.points,n)},[]),linear:new f(function(n){return new fabric.Gradient(n)},[]),object:new f(function(n){return new fabric.Object(n)},[]),path:new f(function(n){return new fabric.Path(n.path,n)},[]),point:new f(function(n){return new fabric.Point(n.x,n.y)},[]),polygon:new f(function(n){return new fabric.Polygon(n.points,n)},[]),polyline:new f(function(n){return new fabric.Polyline(n.points,n)},[]),rect:new f(function(n){return new fabric.Rect(n)},[]),radial:new f(function(n){return new fabric.Gradient(n)},[]),text:new f(function(n){return new fabric.Text(n.text,n)},[]),textbox:new f(function(n){return new fabric.Textbox(n.text,n)},[]),triangle:new f(function(n){return new fabric.Triangle(n)},[])}}return n(r,[{key:"register",value:function(n,r){for(var t=arguments.length,e=new Array(2<t?t-2:0),i=2;i<t;i++)e[i-2]=arguments[i];this.e[n]=new f(r,e||[])}},{key:"fromJson",value:function(n){var t,r=JSON.parse(n),e=this.t.renderOnAddRemove,i=!(this.t.renderOnAddRemove=!1),o=!1,f=void 0;try{for(var a,u=this.t._objects[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var c=a.value;this.t.remove(c)}}catch(n){o=!0,f=n}finally{try{i||null==u.return||u.return()}finally{if(o)throw f}}this.t._objects=[];for(var w={},s=0;s<r.objects.length;s++){var h=r.objects[s].type+s;w[r.objects[s].i=h]=s}t=this.e,r.objects.sort(function(n,r){if(!k(t,n.type))throw new Error("Can't find a definition for given type ".concat(n.type));if(!k(t,r.type))throw new Error("Can't find a definition for given type ".concat(r.type));return t[n.type].isDependant(r.type)?1:t[r.type].isDependant(n.type)?-1:0});var l=new Array(r.objects.length).fill(null),v=!0,y=!1,b=void 0;try{for(var p,d=r.objects[Symbol.iterator]();!(v=(p=d.next()).done);v=!0){var g=p.value,E=this.e[g.type].factory(g);this.t.add(E),l[w[g.i]]=E}}catch(n){y=!0,b=n}finally{try{v||null==d.return||d.return()}finally{if(y)throw b}}this.t._objects=l,this.t.renderOnAddRemove=e,this.t.renderAll()}},{key:"toJson",value:function(){var f=this.e;return JSON.stringify({version:fabric.version,objects:this.t._objects.map(function(n){var r=n.toObject();if(!r.type||!k(f,r.type))throw new Error("Can't find a definition for given type ".concat(r.type));for(var t={},e=0,i=Object.keys(r);e<i.length;e++){var o=i[e];f[r.type].isSaveworthy(o,r[o])&&(t[o]=r[o])}return t})})}}]),r}()}();